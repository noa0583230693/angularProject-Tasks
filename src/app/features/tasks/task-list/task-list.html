<div class="task-list-page">
  <div class="page-header">
    <h1>
      @if(cameFromProject()) {
        <span>ğŸ“‹ ××©×™××•×ª ×‘×¤×¨×•×™×§×˜ {{ projectId }}</span>
      } @else {
        <span>ğŸ“‹ ×›×œ ×”××©×™××•×ª</span>
      }
    </h1>
    @if(cameFromProject()) {
      <button mat-raised-button color="primary" (click)="openAddForm()" class="add-button">
        <span>â• ×”×•×¡×£ ××©×™××” ×—×“×©×”</span>
      </button>
    }
  </div>

  @if(tasks$ | async; as tasks) {
    @if(tasks.length === 0) {
      <div class="empty-state">
        <div class="empty-icon">âœ“</div>
        <h3>××™×Ÿ ××©×™××•×ª ×¢×“×™×™×Ÿ</h3>
        <p>@if(cameFromProject()) {
          ×”×ª×—×œ ×¢"×™ ×”×•×¡×¤×ª ××©×™××” ×—×“×©×”
        } @else {
          ××™×Ÿ ××©×™××•×ª ×œ×”×¦×’×” ×›×¨×’×¢
        }</p>
      </div>
    } @else {
      <div class="tasks-grid">
        @for (task of tasks; track task.id) {
          <div class="task-wrapper">
            <app-task-card
              [task]="task"
              (edit)="onEditTask($event)"
              (delete)="deleteTask($event)">
            </app-task-card>
            <button 
              mat-icon-button 
              matTooltip="×”×¦×’ ×ª×’×•×‘×•×ª" 
              (click)="openComments(task.id)"
              class="comments-button">
              ğŸ’¬
            </button>
          </div>
        }
      </div>
    }
  }

  <!-- Task Edit Modal/Popup -->
  @if(showForm()) {
    <div class="modal-overlay" (click)="closeForm()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ editingTask() ? 'âœï¸ ×¢×“×›×Ÿ ××©×™××”' : 'â• ××©×™××” ×—×“×©×”' }}</h2>
          <button class="close-button" (click)="closeForm()">âœ•</button>
        </div>
        <div class="modal-body">
          <app-task-form
            [task]="editingTask()"
            [projectId]="projectId ?? undefined"
            (create)="createTask($event)"
            (update)="updateTask($event)"
            (cancel)="closeForm()">
          </app-task-form>
        </div>
      </div>
    </div>
  }

  <!-- Comments Modal/Popup -->
  @if(openedCommentsTaskId(); as commentTaskId) {
    <div class="modal-overlay" (click)="closeComments()">
      <div class="modal-content modal-content-comments" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ğŸ’¬ ×ª×’×•×‘×•×ª ×¢×œ ××©×™××”</h2>
          <button class="close-button" (click)="closeComments()">âœ•</button>
        </div>
        <div class="modal-body modal-body-comments">
          <app-list-comments
            [taskId]="commentTaskId"
            (closeMeComments)="closeComments()">
          </app-list-comments>
        </div>
      </div>
    </div>
  }
</div>

